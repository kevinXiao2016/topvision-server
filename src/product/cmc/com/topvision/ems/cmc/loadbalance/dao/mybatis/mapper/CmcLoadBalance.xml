<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"><mapper namespace="com.topvision.ems.cmc.loadbalance.domain.CmcLoadBalance">	<select id="queryLoadBalanceGlobalCfg" parameterType="long" resultType="cmcLoadBalCfg">		SELECT 			cmcId,			topLoadBalConfigCmcIndex,			topLoadBalConfigEnable,			topLoadBalConfigInterval,			topLoadBalConfigMaxMoves,			topLoadBalConfigMethod,			topLoadBalConfigNumPeriod,			topLoadBalConfigPeriod,			topLoadBalConfigTriggerThresh,			topLoadBalConfigDiffThresh,			topLoadBalConfigDccInitAtdma,			topLoadBalConfigDccInitScdma,			topLoadBalConfigDbcInitAtdma,			topLoadBalConfigDbcInitScdma 		FROM  			toploadbalcfg  		WHERE  			cmcId = #{cmcId}	</select>		<select id="selectMaxLoadBalBasicRuleId" resultType="long">	   select max(docsLoadBalBasicRuleId) from docsloadbalbasicrule	</select>		<select id="selectMaxLoadBalPolicyId" resultType="long">       select max(docsLoadBalPolicyId) from docsloadbalpolicy    </select>    	<select id="selectLoadBalanceGroupList" parameterType="long" resultType="cmcLoadBalanceGroup">		SELECT 			grpId,cmcId,groupName, docsLoadBalGrpId 		FROM  			docloadbalgrp  		WHERE  			cmcId = #{cmcId} 	</select>		<select id="selectLBChannelList" parameterType="cmcLoadBalanceGroup" resultType="cmcLoadBalChannel">		SELECT 			channelId,			docsLoadBalChannelIfIndex		FROM 			docloadbalchannel		WHERE			grpId = #{grpId}	</select>		<select id="selectLBMacRangeList" parameterType="cmcLoadBalanceGroup" resultType="cmcLoadBalRestrictCm">		SELECT 			rangId,			grpId,			topLoadBalRestrictCmIndex,			topLoadBalRestrictCmMacRang 		FROM  			toploadbalrestrictcm 		WHERE 			grpId = #{grpId}		</select>		<select id="selectLoadBalanceExcMacRange" parameterType="long" resultType="cmcLoadBalExcludeCm">		SELECT 			excRangId, topLoadBalExcludeCmIndex, topLoadBalExcludeCmMacRang		FROM			toploadbalexcludecm		WHERE			cmcId = #{cmcId} order by topLoadBalExcludeCmIndex	</select>		<select id="selectLoadBalPolicyByEntityId" parameterType="long" resultType="cmcLoadBalPolicy">       select            policyId,entityId,docsLoadBalPolicyId       from            docsloadbalpolicy       where            entityId=#{value}    </select>        <select id="selectLoadBalPolicyById" parameterType="long" resultType="cmcLoadBalPolicy">       select            policyId,entityId,docsLoadBalPolicyId       from            docsloadbalpolicy       where            policyId=#{value}    </select>    	<select id="selectLoadBalancePolicy" parameterType="long" resultType="cmcLoadBalPolicy">		SELECT 			cmcId,policyId 		FROM  			topccmtsloadbalpolicy 		WHERE 			cmcId = #{cmcId}	</select>		<select id="selectLoadBalanceRules" parameterType="long" resultType="cmcLoadBalBasicRule">		SELECT			A.ruleId,A.docsLoadBalBasicRuleId,A.docsLoadBalBasicRuleEnable,A.docsLoadBalBasicRuleDisStart,A.docsLoadBalBasicRuleDisPeriod		FROM			docsloadbalbasicrule A, policyruleref B		WHERE			A.ruleId = B.ruleId		AND			B.policyId = #{policyId}	</select>	<select id="queryLoadBalanceRulesByEntityId" parameterType="long" resultType="cmcLoadBalBasicRule">		SELECT			A.ruleId,A.docsLoadBalBasicRuleId,A.docsLoadBalBasicRuleEnable,A.docsLoadBalBasicRuleDisStart,A.docsLoadBalBasicRuleDisPeriod		FROM			docsloadbalbasicrule A		WHERE			A.entityId = #{entityId}	</select>	<select id="selectLoadBalanceRuleByParam" resultType="cmcLoadBalBasicRule" parameterType="map">	   select            ruleId,entityId,docsLoadBalBasicRuleId,docsLoadBalBasicRuleEnable,docsLoadBalBasicRuleDisStart,docsLoadBalBasicRuleDisPeriod	   from 	       docsloadbalbasicrule	   where 	       entityId=#{entityId}	       and docsLoadBalBasicRuleEnable=#{docsLoadBalBasicRuleEnable}	       <if test="docsLoadBalBasicRuleDisStart != null">	       and docsLoadBalBasicRuleDisStart=#{docsLoadBalBasicRuleDisStart}	       </if>	       <if test="docsLoadBalBasicRuleDisPeriod != null">           and docsLoadBalBasicRuleDisPeriod=#{docsLoadBalBasicRuleDisPeriod}           </if>	</select>	<select id="selectDocsLoadBalGrpIdByGrpId" parameterType="long" resultType="long">		select docsLoadBalGrpId from docloadbalgrp 		where grpId = #{grpId}	</select>	<select id="selectRestrictCmIndexs" parameterType="long" resultType="long">		select topLoadBalRestrictCmIndex from toploadbalrestrictcm		where grpId = #{grpId} order by topLoadBalRestrictCmIndex	</select>	<select id="selectDocsLoadBalGrpIds" parameterType="long" resultType="long">		select docsLoadBalGrpId from docloadbalgrp		where cmcId = #{cmcId} order by docsLoadBalGrpId	</select>	<select id="queryAllRestrictCms" parameterType="long" resultType="cmcLoadBalRestrictCm">		SELECT 			a.rangId,			a.grpId,			a.topLoadBalRestrictCmIndex,			a.topLoadBalRestrictCmMacRang 		FROM  			toploadbalrestrictcm a left join docloadbalgrp b 		on	a.grpId = b.grpId  		WHERE cmcid=#{cmcId}		</select>	<delete id="deleteLoadBalanceExcMacRange" parameterType="cmcLoadBalExcludeCm">		delete from		toploadbalexcludecm where cmcId = #{cmcId} and topLoadBalExcludeCmIndex = #{topLoadBalExcludeCmIndex}	</delete>	<delete id="deleteLoadBalanceGroup" parameterType="map">		delete from		docloadbalgrp where cmcId = #{cmcId} and docsLoadBalGrpId = #{docsLoadBalGrpId}	</delete>	<delete id="deleteLoadBalanceChannel" parameterType="map">		delete from		docloadbalchannel where docsLoadBalChannelIfIndex = #{docsLoadBalChannelIfIndex} and 		grpId  = #{grpId}	</delete>	<delete id="deleteLoadBalanceMacRange" parameterType="map">		delete from		toploadbalrestrictcm where grpId = #{grpId} and 		topLoadBalRestrictCmIndex  = #{topLoadBalRestrictCmIndex}	</delete>		<delete id="deleteTopCcmtsLoadBalPolicyByCmcId" parameterType="long">	   delete from topccmtsloadbalpolicy where cmcId=#{value}	</delete>		<delete id="deleteLoadBalRulesByPolicyId" parameterType="long">	   delete from 	       docsloadbalbasicrule 	   where 	       ruleId in(select ruleId from policyruleref where policyId=#{value})	</delete>		<delete id="deleteLoadBalPolicyRuleRefByPolicyId" parameterType="long">	   delete from policyRuleRef where policyId=#{value}	</delete>		<delete id="deleteLoadBalPolicy" parameterType="long">       delete from            docsloadbalpolicy        where            policyId=#{value}    </delete>		<delete id="deleteLoadBalRule" parameterType="long">       delete from            docsloadbalbasicrule        where            ruleId=#{value}    </delete>        <delete id="deleteLoadBalRuleByEntityId" parameterType="long">        delete from            docsloadbalbasicrule        where            entityId=#{value}    </delete>		<delete id="deleteLoadBalPolicyByEntityId" parameterType="long">	   delete from            docsloadbalpolicy        where            entityId=#{value}	</delete>		<insert id="insertLoadBalGroupChannel" parameterType="cmcLoadBalChannel">		INSERT INTO		docloadbalchannel		(grpId,		docsLoadBalChannelIfIndex)		VALUES		(#{grpId},		#{docsLoadBalChannelIfIndex})	</insert>	<insert id="insertLoadBalanceMacRange" parameterType="cmcLoadBalRestrictCm">		INSERT INTO		toploadbalrestrictcm		(grpId,		topLoadBalRestrictCmIndex,		topLoadBalRestrictCmMacRang)		VALUES		(#{grpId},		(#{topLoadBalRestrictCmIndex},		#{topLoadBalRestrictCmMacRang})	</insert>		<insert id="insertTopCcmtsLoadBalPolicy" parameterType="map">	   insert into topccmtsloadbalpolicy(cmcId,policyId) values(#{cmcId},#{policyId})	</insert>		<update id="updateLoadBalanceGroupName" parameterType="map">	update docloadbalgrp set groupName = #{groupName} where 	grpId = #{grpId}	</update>		<update id="updateLoadBalRule" parameterType="cmcLoadBalBasicRule">	   update 	       docsloadbalbasicrule 	   set	       docsLoadBalBasicRuleEnable=#{docsLoadBalBasicRuleEnable}, 	       docsLoadBalBasicRuleDisStart=#{docsLoadBalBasicRuleDisStart}, 	       docsLoadBalBasicRuleDisPeriod=#{docsLoadBalBasicRuleDisPeriod}	   where	       ruleId=#{ruleId}	</update>		<insert id="insertCmcLoadBalPolicy" parameterType="cmcLoadBalPolicy">	   insert into 	       topccmtsloadbalpolicy(cmcId,policyId)	   values	       (#{cmcId},#{policyId})	</insert>		<insert id="insertPolicyRuleRef" parameterType="map">	   insert into	       policyruleref(ruleId,policyId)	   values	       (#{ruleId},#{policyId})	</insert>	<select id="selectLoadBalanceGroup" parameterType="long" resultType="cmcLoadBalanceGroup">		SELECT 			grpId,cmcId,groupName, docsLoadBalGrpId 		FROM  			docloadbalgrp 		WHERE  			grpId = #{grpId}	</select>	<select id="selectLoadBalanceGroupId" parameterType="cmcLoadBalanceGroup" resultType="long">		SELECT 			grpId 		FROM  			docloadbalgrp 		WHERE  			cmcId = #{cmcId} and groupName=#{groupName} and docsLoadBalGrpId = ${docsLoadBalGrpId}	</select>	<select id="selectLoadBalancePolicyCountByRuleId" parameterType="long" resultType="int">		SELECT 			count(distinct policyId) 		FROM  			policyruleref 		WHERE  			ruleId = #{ruleId}	</select>	<insert id="insertLoadBalPolicy" parameterType="cmcLoadBalPolicy">        insert into             docsloadbalpolicy(policyId,entityId,docsLoadBalPolicyId)         values            (#{policyId},#{entityId},#{docsLoadBalPolicyId})        <selectKey resultType="long" keyProperty="policyId">            SELECT @@IDENTITY AS policyId        </selectKey>    </insert>        <insert id="insertLoadBalBasicRule" parameterType="cmcLoadBalBasicRule">        insert into             docsloadbalbasicrule(ruleId,entityId,docsLoadBalBasicRuleId,docsLoadBalBasicRuleEnable,docsLoadBalBasicRuleDisStart,docsLoadBalBasicRuleDisPeriod)         values            (#{ruleId},#{entityId},#{docsLoadBalBasicRuleId},#{docsLoadBalBasicRuleEnable},#{docsLoadBalBasicRuleDisStart},#{docsLoadBalBasicRuleDisPeriod})         <selectKey resultType="long" keyProperty="ruleId">            SELECT @@IDENTITY AS ruleId        </selectKey>    </insert>        <select id="getCmcLoadBalCfgCount" parameterType="long"		resultType="long">		select count(*)		from toploadbalcfg where		cmcId = #{cmcId}	</select>		<update id="updateCmcLoadBalCfg" parameterType="cmcLoadBalCfg">		Update		toploadbalcfg set		topLoadBalConfigCmcIndex =		#{topLoadBalConfigCmcIndex},		topLoadBalConfigEnable =		#{topLoadBalConfigEnable},		topLoadBalConfigInterval =		#{topLoadBalConfigInterval},		topLoadBalConfigMaxMoves =		#{topLoadBalConfigMaxMoves},		topLoadBalConfigMethod =		#{topLoadBalConfigMethod},		topLoadBalConfigNumPeriod =		#{topLoadBalConfigNumPeriod},		topLoadBalConfigPeriod =		#{topLoadBalConfigPeriod},		topLoadBalConfigTriggerThresh =		#{topLoadBalConfigTriggerThresh},		topLoadBalConfigDiffThresh =		#{topLoadBalConfigDiffThresh},		topLoadBalConfigDccInitAtdma =		#{topLoadBalConfigDccInitAtdma},		topLoadBalConfigDccInitScdma =		#{topLoadBalConfigDccInitScdma},		topLoadBalConfigDbcInitAtdma =		#{topLoadBalConfigDbcInitAtdma},		topLoadBalConfigDbcInitScdma =		#{topLoadBalConfigDbcInitScdma}		where cmcId = #{cmcId}	</update>		<insert id="insertCmcLoadBalCfg" parameterType="cmcLoadBalCfg">		INSERT INTO		toploadbalcfg		(cmcId,		topLoadBalConfigCmcIndex,		topLoadBalConfigEnable,		topLoadBalConfigInterval,		topLoadBalConfigMaxMoves,		topLoadBalConfigMethod,		topLoadBalConfigNumPeriod,		topLoadBalConfigPeriod,		topLoadBalConfigTriggerThresh,		topLoadBalConfigDiffThresh,		topLoadBalConfigDccInitAtdma,		topLoadBalConfigDccInitScdma,		topLoadBalConfigDbcInitAtdma,		topLoadBalConfigDbcInitScdma)		VALUES		(#{cmcId},		#{topLoadBalConfigCmcIndex},		#{topLoadBalConfigEnable},		#{topLoadBalConfigInterval},		#{topLoadBalConfigMaxMoves},		#{topLoadBalConfigMethod},		#{topLoadBalConfigNumPeriod},		#{topLoadBalConfigPeriod},		#{topLoadBalConfigTriggerThresh},		#{topLoadBalConfigDiffThresh},		#{topLoadBalConfigDccInitAtdma},		#{topLoadBalConfigDccInitScdma},		#{topLoadBalConfigDbcInitAtdma},		#{topLoadBalConfigDbcInitScdma})	</insert>		<select id="selectAllCmcLoadBalGrp" parameterType="long"		resultType="cmcLoadBalGrp">		select groupName, docsLoadBalGrpId		from		docloadbalgrp where		cmcId = #{cmcId}	</select>	<delete id="deleteAllCmcLoadBalGrp" parameterType="long">		delete from		docloadbalgrp where		cmcId=#{cmcId}	</delete>	<insert id="insertCmcLoadBalGrp" parameterType="cmcLoadBalGrp">		INSERT INTO		docloadbalgrp		(cmcId,		groupName,		docsLoadBalGrpId)		VALUES		(#{cmcId},		#{groupName},		#{docsLoadBalGrpId})		<selectKey resultType="long" keyProperty="grpId">			SELECT @@IDENTITY			AS grpId		</selectKey>	</insert>	<select id="selectLoadBalGrpId" parameterType="cmcLoadBalChannel"		resultType="long">		select grpId		from docloadbalgrp		where cmcId = #{cmcId} and		docsLoadBalGrpId = #{docsLoadBalGrpId}	</select>	<insert id="insertCmcLoadBalChannel" parameterType="cmcLoadBalChannel">		INSERT INTO		docloadbalchannel		(grpId,		docsLoadBalChannelIfIndex)		VALUES		(#{grpId},		#{docsLoadBalChannelIfIndex})	</insert>	<select id="selectGrpIdByCmcIdAndIndex" parameterType="cmcLoadBalRestrictCm"		resultType="long">		select grpId		from		docloadbalgrp where cmcId = #{cmcId} and		docsLoadBalGrpId = #{docsLoadBalGrpId}	</select>	<insert id="insertCmcLoadBalRestrictCm" parameterType="cmcLoadBalRestrictCm">		INSERT		INTO		toploadbalrestrictcm		(grpId,		topLoadBalRestrictCmIndex,		topLoadBalRestrictCmMacRang)		VALUES		(#{grpId},		#{topLoadBalRestrictCmIndex},		#{topLoadBalRestrictCmMacRang})	</insert>	<delete id="deleteAllCmcCmcLoadBalExcludeCm" parameterType="long">		delete from		toploadbalexcludecm where		cmcId=#{cmcId}	</delete>		<insert id="insertCmcCmcLoadBalExcludeCm" parameterType="cmcLoadBalExcludeCm">		INSERT		INTO		toploadbalexcludecm		(cmcId,		topLoadBalExcludeCmIndex,		topLoadBalExcludeCmMacRang)		VALUES		(#{cmcId},		#{topLoadBalExcludeCmIndex},		#{topLoadBalExcludeCmMacRang})	</insert>		<select id="selectAllCmcLoadBalGrpOnOlt" parameterType="long"		resultType="cmcLoadBalGrp">		select groupName,		docsLoadBalGrpId,		cmcId		from docloadbalgrp		where cmcId in		(select cmcId from cmcentityrelation where cmcEntityId =		#{entityId})	</select>	<delete id="deleteAllCmcLoadBalGrpOnOlt" parameterType="long">		delete		from		docloadbalgrp where		cmcId in (select cmcId		from cmcentityrelation		where cmcEntityId = #{entityId})	</delete>		<select id="getCmcIdByCmcIndexAndEntityId" parameterType="map"		resultType="long">		select cmcId from cmcentityrelation		where cmcIndex =		#{cmcIndex} and cmcEntityId=#{entityId}	</select></mapper>